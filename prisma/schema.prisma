// =====================================================
// ENUMS
// =====================================================

enum OrderStatus {
    PENDING_PAYMENT // created but not paid
    PAID // payment succeeded
    PROCESSING // you are preparing the order
    SHIPPED
    DELIVERED
    CANCELLED
}

enum PaymentStatus {
    PENDING
    REQUIRES_ACTION
    SUCCEEDED
    FAILED
    REFUNDED
}

enum PaymentProvider {
    STRIPE
    RAZORPAY
}

// =====================================================
// GENERATOR / DATASOURCE
// =====================================================

generator client {
    provider = "prisma-client"
    output   = "../app/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

// =====================================================
// CATEGORY & PRODUCT
// =====================================================

model Category {
    id       Int       @id @default(autoincrement())
    slug     String    @unique
    name     String
    products Product[]
}

model Product {
    id          Int     @id @default(autoincrement())
    slug        String  @unique
    name        String
    description String
    new         Boolean @default(false)
    features    String
    price       Int

    // legacy support
    imageUrl String?

    // relations
    categoryId Int
    category   Category @relation(fields: [categoryId], references: [id])

    orderItems OrderItem[]

    // new relational additions
    images          ProductImage?
    categoryImages  CategoryImage?
    includes        ProductInclude[]
    gallery         ProductGallery[]
    recommendations ProductRecommendation[] // products it recommends
    recommendedBy   ProductRecommendation[] @relation("RecommendedBy") // products recommending this product

    createdAt DateTime  @default(now())
    updatedAt DateTime? @updatedAt
}

// =====================================================
// PRODUCT IMAGE MODELS (NEW)
// =====================================================

// Responsive main product image (mobile/tablet/desktop)
model ProductImage {
    id        Int    @id @default(autoincrement())
    productId Int    @unique
    mobile    String
    tablet    String
    desktop   String

    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Responsive category preview image
model CategoryImage {
    id        Int    @id @default(autoincrement())
    productId Int    @unique
    mobile    String
    tablet    String
    desktop   String

    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Includes { quantity + item }
model ProductInclude {
    id        Int    @id @default(autoincrement())
    productId Int
    quantity  Int
    item      String

    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// Gallery images: first / second / third
model ProductGallery {
    id        Int             @id @default(autoincrement())
    productId Int
    position  GalleryPosition
    mobile    String
    tablet    String
    desktop   String

    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

    @@unique([productId, position])
}

enum GalleryPosition {
    FIRST
    SECOND
    THIRD
}

// Recommended products (self relation)
model ProductRecommendation {
    id                   Int    @id @default(autoincrement())
    productId            Int
    recommendedProductId Int
    mobile               String
    tablet               String
    desktop              String

    product            Product @relation(fields: [productId], references: [id])
    recommendedProduct Product @relation("RecommendedBy", fields: [recommendedProductId], references: [id])
}

// =====================================================
// ORDER / PAYMENT (UNCHANGED)
// =====================================================

model Payment {
    id       String          @id @default(cuid())
    orderId  String          @unique
    provider PaymentProvider
    status   PaymentStatus   @default(PENDING)

    amount   Int
    currency String @default("INR")

    providerPaymentId String?
    providerOrderId   String?
    rawPayload        Json?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Order {
    id          String  @id @default(cuid())
    trackingId  String  @unique @default(ulid())
    email       String
    fullName    String
    phoneNumber String?

    addressLine1 String
    addressLine2 String?
    city         String
    state        String
    postalCode   String
    country      String

    status      OrderStatus @default(PENDING_PAYMENT)
    totalAmount Int
    currency    String      @default("INR")

    items   OrderItem[]
    payment Payment?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model OrderItem {
    id        Int    @id @default(autoincrement())
    orderId   String
    productId Int

    quantity  Int
    unitPrice Int
    subtotal  Int

    order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id])

    @@index([orderId])
    @@index([productId])
}
